## NetVuln - gRPC сервис для сканирования уязвимостей с использованием Nmap

NetVuln — это сервис, который использует Nmap для сканирования уязвимостей на целевых хостах, используя скрипт nmap-vulners для поиска известных уязвимостей. Сервис реализован через gRPC API и предоставляет возможность сканировать IP-адреса и порты на наличие уязвимостей.

## Структура проекта

Проект состоит из нескольких компонентов:

**API (gRPC)** — описание сервисов и сообщений с использованием Protocol Buffers.       
**Сервер** — основной сервис, который запускает gRPC сервер и обрабатывает запросы на сканирование.     
**Сканер** — модуль, который использует Nmap для сканирования целевых хостов.       
**Клиент** — простой клиент для отправки запросов на сервер.        
**Конфигурация** — управление конфигурацией через переменные окружения.         

## Требования

Перед тем как запустить проект, убедитесь, что у вас установлены следующие инструменты:

Go (1.18 и выше) — язык программирования, используемый для разработки сервиса.          
Nmap — инструмент для сканирования сети, который будет использоваться для поиска уязвимостей.           
Protobuf Compiler (protoc) — для генерации Go-кода из .proto файлов.        
Docker (опционально) — для контейнеризации и упрощения развертывания.

## Установка       

1. Установка зависимостей

Скачайте и установите все необходимые зависимости для Go-проекта:

```
go mod tidy
```

2. Установка Nmap

Для использования сканера необходимо установить Nmap. Вы можете установить его с помощью следующей команды:

Для Ubuntu/Debian:

```
sudo apt-get install nmap
```
Для macOS (с использованием Homebrew):
```
brew install nmap
```
Для Windows:

Скачайте установочный файл с официального сайта: https://nmap.org/download.html.

## Настройка

1. Конфигурация

Конфигурация сервиса загружается из переменных окружения. Вы можете настроить следующие параметры:

**SERVICE_ADDRESS** — адрес и порт, на котором будет работать сервер (по умолчанию :50051).

**LOG_LEVEL** — уровень логирования (по умолчанию INFO).

Для настройки можно использовать файл .env или задать переменные окружения вручную.

## Пример использования:
```
export SERVICE_ADDRESS="localhost:50051"
export LOG_LEVEL="DEBUG"
```

2. Генерация Go-кода из Protobuf

Для генерации Go-кода из файла netvuln.proto, используйте protoc:

```
protoc --go_out=plugins=grpc:. api/proto/netvuln.proto
```
Это создаст соответствующие Go-структуры и методы для gRPC сервиса.

## Запуск сервиса

Для запуска сервера выполните следующую команду:
```
make run-server
```

Это скомпилирует и запустит сервер на порту, указанном в переменной окружения SERVICE_ADDRESS (по умолчанию localhost:50051).

## Использование клиента

Для взаимодействия с сервером, используйте клиент, который отправляет запросы на сервер.

1. Запуск клиента

Чтобы запустить клиент, используйте следующую команду:

```
make run-client
```
или

```
go run cmd/client/main.go --address localhost:50051 --targets 8.8.8.8 --port 80
```

Здесь:

--address — адрес сервера (по умолчанию localhost:50051).       
--targets — целевые IP-адреса для сканирования (через запятую).     
--port — порт для сканирования (по умолчанию 80).       

## Получение ответа от сервера

После выполнения запроса, клиент получит ответ от сервера с результатами сканирования. 

Ответ содержит информацию о целевом хосте, сервисах, работающих на указанном порту, и найденных уязвимостях.


**Проверка уязвимостей**

Для того чтобы проверить, возвращает ли сервер уязвимости, выполните следующие шаги:

Убедитесь, что скрипт nmap-vulners установлен и доступен для Nmap.
```
nmap --script=vulners --version
```

Если скрипт доступен, вы увидите его версию.

Запустите клиент с целевым хостом, на котором есть уязвимый сервис. Например:
```
go run cmd/client/main.go -address=localhost:50051 -targets=8.8.8.8 -port=80

Где 8.8.8.8 — это IP-адрес уязвимого хоста.
```

После выполнения запроса вы получите ответ, который будет содержать информацию о найденных уязвимостях, если таковые имеются.

***Тестирование с уязвимым сервисом*** 

Для тестирования вы можете использовать виртуальную машину с уязвимым сервисом, например:

Установите старую версию Apache или другой сервис с известными уязвимостями.
Запустите Apache на порту 80.
Используйте клиент для сканирования этого сервиса.
Также можно использовать публичные сервисы для тестирования, например, с платформы VulnHub или Hack The Box.

## Тестирование

1. Запуск тестов

```
make test
```

Вы можете запустить отдельные тесты для различных компонентов:

Тесты сервиса:
```
make test-service
```
Тесты клиента:
```
make test-client
```

## Пример взаимодействия с сервисом
1. Пример gRPC-запроса с использованием grpcurl
Вы можете использовать инструмент grpcurl для отправки запросов на сервер. 

Пример команды:
```
grpcurl -plaintext -d '{"targets":["8.8.8.8"], "tcp_port":80}' localhost:50051 netvuln.v1.NetVulnService/CheckVuln
```

Заключение
Проект NetVuln предоставляет удобный сервис для сканирования уязвимостей с использованием Nmap и gRPC. Вы можете развернуть сервис на своем сервере, а также использовать клиент для отправки запросов.
